<div class='spec'>
<table>
<% fields_for "product[spec_attributes][]", product_spec do |product_spec_form| %>
<tr>
    <td>Product Spec:</td><td><%= product_spec_form.collection_select :spec_id, Spec.all, :id, :name, {}, {:index => nil} %></td>
  	<td>Value:</td><td>
		<%= find_inputfield(product_spec.spec.type, product_spec_form, product_spec) %>
		<%= product_spec_form.hidden_field :required, :index => nil %></td>
	<% if product_spec.new_record? %>
		<td>
			<% unless product_spec.required? %>
				<%= link_to_function "remove", "$(this).up('.spec').remove()" %>
			<% end %>
		</td>
	<% else %>
		<td>
			<% unless product_spec.required? %>
				<%= link_to_function "remove", "mark_for_destroy(this)" %>
			<% end %>
			<%= product_spec_form.hidden_field :id, :index => nil %>
			<%= product_spec_form.hidden_field :should_destroy, :index => nil, :class => 'should_destroy' %>
		</td>
	<% end %>
</tr>
<% end %>
</table>
</div>